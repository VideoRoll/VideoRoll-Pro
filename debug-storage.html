<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VideoRoll-Pro Storage Debug</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .button {
            background: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .button:hover {
            background: #005a87;
        }
        .output {
            background: #f5f5f5;
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
        .error {
            color: red;
        }
        .success {
            color: green;
        }
    </style>
</head>
<body>
    <h1>VideoRoll-Pro Layout Configuration Storage Debug</h1>
    
    <div>
        <button class="button" onclick="loadConfig()">Load Config</button>
        <button class="button" onclick="saveTestConfig()">Save Test Config</button>
        <button class="button" onclick="clearConfig()">Clear Config</button>
        <button class="button" onclick="clearOutput()">Clear Output</button>
    </div>
    
    <div id="output" class="output">Click buttons above to test storage operations...</div>

    <script>
        const outputEl = document.getElementById('output');
        const STORAGE_KEY = 'video_roll_layout_config';
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            outputEl.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            outputEl.scrollTop = outputEl.scrollHeight;
        }
        
        function clearOutput() {
            outputEl.innerHTML = '';
        }
        
        async function loadConfig() {
            try {
                log('Loading configuration from browser.storage.local...');
                const result = await chrome.storage.local.get(STORAGE_KEY);
                
                if (result[STORAGE_KEY]) {
                    log('Configuration found:', 'success');
                    log(JSON.stringify(result[STORAGE_KEY], null, 2));
                } else {
                    log('No configuration found in storage', 'error');
                }
            } catch (error) {
                log(`Error loading config: ${error.message}`, 'error');
            }
        }
        
        async function saveTestConfig() {
            try {
                log('Saving test configuration...');
                const testConfig = {
                    version: '1.0.0',
                    tabs: [
                        {
                            id: 'video',
                            name: '视频',
                            nameKey: 'tabs_video',
                            icon: 'DeviceTv',
                            visible: true,
                            rows: [
                                {
                                    id: 'row_test_1',
                                    maxColumns: 2,
                                    components: [
                                        {
                                            id: 'rotate',
                                            name: '旋转',
                                            nameKey: 'video_rotate',
                                            component: null,
                                            category: 'video',
                                            visible: true,
                                            order: 1,
                                            colSpan: 12
                                        },
                                        {
                                            id: 'loop',
                                            name: '循环',
                                            nameKey: 'video_loop',
                                            component: null,
                                            category: 'video',
                                            visible: true,
                                            order: 2,
                                            colSpan: 6
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                };
                
                await chrome.storage.local.set({
                    [STORAGE_KEY]: testConfig
                });
                
                log('Test configuration saved successfully!', 'success');
                log(JSON.stringify(testConfig, null, 2));
            } catch (error) {
                log(`Error saving test config: ${error.message}`, 'error');
            }
        }
        
        async function clearConfig() {
            try {
                log('Clearing configuration...');
                await chrome.storage.local.remove(STORAGE_KEY);
                log('Configuration cleared successfully!', 'success');
            } catch (error) {
                log(`Error clearing config: ${error.message}`, 'error');
            }
        }
        
        // Auto-load config on page load
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(loadConfig, 500);
        });
    </script>
</body>
</html>
